<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='imags/icon.png') }}" type="image/x-icon">
</head>
<body>
    <header class="site-header">
        <nav>
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="navbar-nav" id="navbarNav">
                <a class="nav-item" href="{{ url_for('home') }}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a class="nav-item" href="{{ url_for('chat') }}">Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</a>
                <a class="nav-item" href="{{ url_for('about') }}">Ø¹Ù† Ø§Ù„ØµÙØ­Ø©</a>
                {% if current_user.is_authenticated %}
                    <a class="nav-item" href="{{ url_for('volunteer') }}">ØªØ·ÙˆØ¹</a>
                    <a class="nav-item" href="{{ url_for('history') }}">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</a>
                    <a class="nav-item" href="{{ url_for('logout') }}">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
                {% else %}
                    <a class="nav-item" href="{{ url_for('login') }}">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</a>
                {% endif %}
            </div>
        </nav>
    </header>


 <div class="history-header">
    <h1>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h1>
</div>

<div class="history-container">
    {% if conversations %}
        <!-- New format: Sessions with messages -->
        {% for session_id, session_chats in conversations.items() %}
        <div class="chat-entry">
            <button class="collapse-toggle">
                {% if session_id == 'legacy' %}
                    Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
                {% else %}
                    Ø¬Ù„Ø³Ø© Ù…Ø­Ø§Ø¯Ø«Ø© - {{ session_chats[0].timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
                {% endif %}
            </button>
            <div class="chat-content">
                {% for chat in session_chats %}
                    <div class="message">
                        <p><strong>{{ chat.message_type|title }}:</strong> {{ chat.content.replace('\n', '<br>') | safe }}</p>
                        <small>{{ chat.timestamp.strftime('%H:%M:%S') }}</small>
                    </div>
                {% endfor %}
                <form action="{{ url_for('delete_chat', chat_id=session_chats[0].id) }}" method="post">
                    <button class="delete-button" type="submit">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©</button>
                </form>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <!-- Old format: Individual chats -->
        {% for chat in chats %}
        <div class="chat-entry">
            <button class="collapse-toggle">
                Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨ØªØ§Ø±ÙŠØ® {{ chat.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
            </button>
            <div class="chat-content">
                <p>{{ chat.content.replace('\n', '<br>') | safe }}</p>
                <form action="{{ url_for('delete_chat', chat_id=chat.id) }}" method="post">
                    <button class="delete-button" type="submit">ğŸ—‘ Ø­Ø°Ù</button>
                </form>
            </div>
        </div>
        {% endfor %}
    {% endif %}
    
    {% if not conversations and not chats %}
        <div class="no-history">
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
        </div>
    {% endif %}
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const hamburger = document.getElementById("hamburger");
    const navbarNav = document.getElementById("navbarNav");

    hamburger.addEventListener("click", () => {
      navbarNav.classList.toggle("show");
      hamburger.classList.toggle("active");
    });

    // Optional: Close nav when a link is clicked
    const navItems = document.querySelectorAll(".nav-item");
    navItems.forEach(item => {
      item.addEventListener("click", () => {
        navbarNav.classList.remove("show");
        hamburger.classList.remove("active");
      });
    });

    // Optional: Close nav if user clicks outside
    document.addEventListener("click", (e) => {
      if (!navbarNav.contains(e.target) && !hamburger.contains(e.target)) {
        navbarNav.classList.remove("show");
        hamburger.classList.remove("active");
      }
    });
  });
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const toggles = document.querySelectorAll('.collapse-toggle');
    toggles.forEach(toggle => {
        toggle.addEventListener('click', () => {
            const content = toggle.nextElementSibling;
            content.classList.toggle('collapsed');
        });
    });
});
</script>

</body>
</html>
